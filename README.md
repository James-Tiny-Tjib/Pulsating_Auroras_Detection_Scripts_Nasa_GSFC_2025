# Pulsating Auroras Detection Scripts (NASA GSFC 2025)
**Space Club Scholar Intern Project 2025**

This suite of tools is designed for the automated detection, logging, and visualization of pulsating auroras using ground-based imager data.

> **Recommendation:** Use a virtual environment to manage dependencies.
> **Path Note:** When configuring file paths, ensure backslashes are escaped (e.g., `Data_Folder\\ut02`) or use forward slashes (e.g., `Data_Folder/ut02`).

## Project Directory Structure
All Python scripts should be located in the same root directory. The data directory (`Big_Data`) can be located elsewhere, provided the paths in the scripts are updated.

```text
Project_Root/
│
├── master_analysis.py         # Main controller for batch analysis
├── detection.py               # Core detection algorithms
├── detection_viewer.py        # Interactive results viewer
├── investigation2.py          # Viewer with manual annotation tools
├── full_day_keogram.py        # Keogram generation tool
├── analyzer.py                # Legacy analysis tool
│
└── Big_Data/                  # Example Data Structure
    ├── Day 1/
    │   ├── ut02/
    │   │   ├── THA...16bit.log
    │   │   ├── THA...16bit.tif
    │   │   └── ...
    │   └── ut03/
    └── Day 2/

```

---

## 1. `master_analysis.py`

**Description:**
The primary entry point for the suite. It orchestrates large-scale batch processing across multiple days of data and provides a menu to launch the interactive viewer for specific results.

**Features:**

* **Batch Analysis (Option 1):** Scans the parent data directory, processes all valid subdirectories, and generates reports and plots.
* **Viewer Integration (Option 2):** Launches `detection_viewer.py` for a user-specified dataset.

**Configurable Parameters:**

* `PARENT_DATA_DIRECTORY`: (String) The root folder containing day/hour subdirectories (e.g., `"Big_Data"`).
* `MAIN_OUTPUT_FOLDER`: (String) The destination folder for all analysis reports and plots.
* `CONFIG` Dictionary:
* `keep_duplicates`: (Bool) `True` to keep all detections; `False` to merge adjacent detections (recommended).
* `generate_individual_plots`: (Bool) `True` to generate PNGs for every detected event.
* `generate_full_region_plots`: (Bool) `True` to generate full time-series plots for every grid region.
* `use_true_peaks`: (Bool) `True` to use the raw data maximum for peak intensity; `False` to use the smoothed value.



---

## 2. `detection.py`

**Description:**
The core module containing the algorithms for identifying pulsating auroras. It runs as a library for the master script but can be executed standalone for single-hour debugging.

**Features:**

* **Grid Extraction:** Extracts intensity time-series from 36 regions (6x6 grid) within the raw TIFF images.
* **Parallel Processing:** Uses CPU cores to process multiple regions or files simultaneously.
* **Peak Detection:** Uses Savitzky-Golay filtering and dynamic prominence thresholding to find pulsations.

**Configurable Parameters (inside `analyze_pulsations_with_grid`):**

* `FPS`: (Float) Frames per second of the source data (e.g., `56.7`).
* `PIXEL_SIZE`: (Int) Dimension of the square analysis box in pixels (e.g., `6`).
* `GRID_DIMENSIONS`: (Tuple) Layout of the analysis grid (rows, cols) (e.g., `(6, 6)`).
* `IMAGE_SIZE`: (Tuple) Resolution of the input images (e.g., `(128, 128)`).
* `NORMAL_PROMINENCE`: (Int) Primary intensity threshold for peak detection (e.g., `80`).
* `REDUCED_PROMINENCE`: (Int) Lower threshold for peaks occurring on bright backgrounds (e.g., `30`).
* `HIGH_BASE_THRESHOLD`: (Int) Intensity level defining a "bright" background (e.g., `900`).
* `SIGMA_CLIP_THRESHOLD`: (Int) Sigma value for outlier rejection during data extraction (e.g., `2`).
* `MAX_PULSATION_SECONDS`: (Float) Max duration for a valid event (e.g., `30.0`).
* `MIN_PROMINENCE_WIDTH_RATIO`: (Float) Sharpness filter; higher excludes wider/slower pulses.

---

## 3. `detection_viewer.py`

**Description:**
An interactive visualization tool for inspecting analysis results. It renders the original high-bit depth TIFF data and overlays detection metrics.

**Features:**

* **Full Movie Player:** Plays the full image sequence with real-time color-coded overlays (Red=Inactive, Yellow=Active, Lime=Peak).
* **Interval Player:** Targeted playback of specific detected events.
* **Video Export:** Exports specific pulsation events to MP4 with custom speed and annotations.

**Configurable Parameters (in `if __name__ == '__main__':`):**

* `DATA_FOLDER`: (String) Path to the specific hour directory to view (e.g., `"Big_Data\\Day_1\\ut15"`).
* `REPORT_FILE`: (String) Path to the `..._report.txt` generated by the analysis.
* `BUFFER_SIZE`: (Int) Number of frames to preload for smooth playback (e.g., `1000`).
* `FPS`: (Float) Frame rate for time calculations (e.g., `56.7`).

---

## 4. `investigation2.py`

**Description:**
An enhanced viewer featuring a **Manual Investigation Mode**. It allows users to annotate events during playback for targeted sub-region analysis.

**Features:**

* **Manual Annotation:** Click on grid regions during playback to mark events.
* **Automated Follow-up:** Automatically performs analysis on marked frames upon closing the player.
* **Logging:** Generates a separate `manual_analysis_log.txt`.

**Configurable Parameters (in `if __name__ == '__main__':`):**

* `DATA_FOLDER`: (String) Path to the data directory.
* `REPORT_FILE`: (String) Path to an existing report file (optional, can be dummy path if just investigating).
* `BUFFER_SIZE`: (Int) Playback buffer size.
* `IMAGE_SIZE` / `PIXEL_SIZE`: (Int) Must match the settings used in `detection.py`.

---

## 5. `full_day_keogram.py`

**Description:**
Generates a full-day Keogram (North-South or East-West spectral slice) from a directory containing multiple hours of data.

**Features:**

* **Mega-Keogram:** Stitches together data from separate hourly folders into one continuous plot.
* **Parallel Loading:** optimized to handle large datasets without crashing memory.

**Configurable Parameters (in `main`):**

* `RAM_FOR_LARGE_TIFF`: (Int) GB of RAM estimate per file to limit worker count (e.g., `2`).
* `folder_path`: (String) Path to the Day folder (e.g., `"Big_Data\\Day_1"`).
* `direction`: (String) `"NS"` for North-South (columns) or `"EW"` for East-West (rows).
* `start_index` / `end_index`: (Int) The row/column indices to slice (e.g., `64`, `65`).
* `increment_by`: (Int) Skip frames to reduce processing time (e.g., `10`).

---

## 6. `analyzer.py` (Legacy)

**Description:**
A standalone menu-driven tool for investigating fine details in specific hours of data.

**Features:**

* **Time Editing:** Interactively refine start and end times for analysis.
* **Visualizations:** Generates Keograms and Time-Intensity plots for the defined window.
* **Basic Playback:** Simple image sequence player.

**Configurable Parameters:**

* `folder_path`: (String) Hardcoded path in `main` pointing to the hour directory (e.g., `"Big_Data/Day_1/ut02"`).
* `get_col_6166` / `get_row_6166`: (Functions) The slice indices (default 61-67) are hardcoded in these functions and must be edited manually if different regions are needed.
